<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>EduFlex Back Office</title>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ asset('css/admin.css') }}">
  </head>
  <body>
    <div class="admin-shell">
      <aside class="admin-sidebar">
        <div class="brand">
          <img class="brand-logo" src="{{ asset('images/eduflex-logo.png') }}" alt="EduFlex">
          <div class="brand-text">
            <div class="brand-name">EduFlex</div>
          </div>
        </div>

        <nav class="nav">
          <a class="nav-link is-active" href="{{ path('app_admin') }}"><span class="nav-icon">ğŸ </span>Dashboard Admin</a>
          <a class="nav-link" href="{{ path('app_admin_copilot') }}"><span class="nav-icon">AI</span>Copilote IA</a>
          <a class="nav-link" href="{{ path('app_forum_index_context', {'context': 'admin'}) }}"><span class="nav-icon">F</span>Forum</a>
          <a class="nav-link" href="{{ path('app_utilisateur_index') }}"><span class="nav-icon">ğŸ‘¥</span>Utilisateurs</a>
          <a class="nav-link" href="#"><span class="nav-icon">ğŸ«</span>Classes</a>
          <a class="nav-link" href="#"><span class="nav-icon">ğŸ“š</span>MatiÃ¨res</a>
          <a class="nav-link" href="#"><span class="nav-icon">ğŸ”</span>Droits d'accÃ¨s</a>
          <a class="nav-link" href="#"><span class="nav-icon">ğŸ“ˆ</span>Statistiques</a>
          <a class="nav-link" href="#"><span class="nav-icon">âš™ï¸</span>ParamÃ¨tres</a>
          <a class="nav-link" href="{{ path('app_logout') }}"><span class="nav-icon">â†©</span>Logout</a>
        </nav>

        <div class="sidebar-card">
          <div class="sidebar-card-title">Actions rapides</div>
          <button class="btn btn-primary" type="button">CrÃ©er un cours</button>
          <a class="btn btn-outline" href="{{ path('app_utilisateur_new') }}">Ajouter un utilisateur</a>
        </div>
      </aside>

      <main class="admin-main">
        <header class="topbar">
          <div>
            <div class="topbar-title">Dashboard Admin</div>
            <div class="topbar-sub">Bienvenue sur EduFlex, Administration</div>
          </div>
          <div class="topbar-actions">
            <button class="chip" type="button">Nouveau rapport</button>
            <a class="chip" href="{{ path('app_logout') }}">Logout</a>
            <div class="avatar">{{ admin_initials }}</div>
          </div>
        </header>

        <section class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">ğŸ“</div>
            <div class="stat-label">Total Usagers</div>
            <div class="stat-value">{{ stats.total_users|number_format(0, ',', ' ') }}</div>
            <div class="stat-meta up">{{ stats.verified_users|number_format(0, ',', ' ') }} comptes verifies</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">ğŸ«</div>
            <div class="stat-label">Classes</div>
            <div class="stat-value">{{ stats.total_classes|number_format(0, ',', ' ') }}</div>
            <div class="stat-meta up">+{{ stats.new_classes_month|number_format(0, ',', ' ') }} ce mois</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">ğŸŒ</div>
            <div class="stat-label">ActivitÃ©s</div>
            <div class="stat-value">{{ stats.total_activities|number_format(0, ',', ' ') }}</div>
            <div class="stat-meta up">+{{ stats.activities_week|number_format(0, ',', ' ') }} cette semaine</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">ğŸ§¾</div>
            <div class="stat-label">Messages</div>
            <div class="stat-value">{{ stats.total_messages|number_format(0, ',', ' ') }}</div>
            <div class="stat-meta {{ stats.messages_change_percent >= 0 ? 'up' : 'down' }}">
              {{ stats.messages_change_percent >= 0 ? '+' : '' }}{{ stats.messages_change_percent }}% vs. semaine
            </div>
          </div>
        </section>

        <section class="content-grid">
          <div class="panel">
            <div class="panel-header">
              <h2>Statistiques globales de la plateforme</h2>
              <span class="panel-sub">7 derniers jours</span>
            </div>
            <div class="chart-placeholder">
              <div class="chart-line chart-line-1"></div>
              <div class="chart-line chart-line-2"></div>
              <div class="chart-line chart-line-3"></div>
            </div>
            <div class="chart-legend">
              <span class="legend-item"><span class="dot dot-green"></span>Engagement</span>
              <span class="legend-item"><span class="dot dot-purple"></span>PrÃ©sence</span>
              <span class="legend-item"><span class="dot dot-sage"></span>Messages</span>
            </div>
          </div>

          <div class="panel">
            <div class="panel-header">
              <h2>Gestion des utilisateurs</h2>
              <span class="panel-sub">RÃ©partition</span>
            </div>
            <div class="list">
              <div class="list-item">
                <div class="list-title">Ã‰tudiants</div>
                <div class="list-metric">{{ users_by_role.etudiants|number_format(0, ',', ' ') }}</div>
              </div>
              <div class="list-item">
                <div class="list-title">Enseignants</div>
                <div class="list-metric">{{ users_by_role.enseignants|number_format(0, ',', ' ') }}</div>
              </div>
              <div class="list-item">
                <div class="list-title">Parents</div>
                <div class="list-metric">{{ users_by_role.parents|number_format(0, ',', ' ') }}</div>
              </div>
              <div class="list-item">
                <div class="list-title">Administrateurs</div>
                <div class="list-metric">{{ users_by_role.admins|number_format(0, ',', ' ') }}</div>
              </div>
            </div>
          </div>
        </section>

        <section class="panel full copilot-panel">
          <div class="panel-header">
            <h2>Copilote Admin IA</h2>
            <span class="panel-sub">Questions rapides sur les utilisateurs</span>
          </div>
          {% for message in app.flashes('error') %}
            <div class="copilot-alert">{{ message }}</div>
          {% endfor %}
          <form method="post" action="{{ path('app_admin') }}" class="copilot-form">
            <input type="hidden" name="_token" value="{{ csrf_token('admin_copilot') }}">
            <label class="copilot-label" for="copilot-question">Votre question</label>
            <div class="copilot-row">
              <input
                id="copilot-question"
                name="question"
                type="text"
                value="{{ copilot_question|default('') }}"
                placeholder="Ex: combien de nouveaux comptes cette semaine ?"
                class="copilot-input"
                required
              >
              <button type="submit" class="btn btn-primary">Demander</button>
            </div>
            <div class="copilot-examples">
              <button class="btn btn-outline small" type="submit" name="question" value="combien de nouveaux comptes cette semaine ?">Nouveaux comptes semaine</button>
              <button class="btn btn-outline small" type="submit" name="question" value="liste comptes non verifies">Comptes non verifies</button>
              <button class="btn btn-outline small" type="submit" name="question" value="repartition des roles utilisateurs">Repartition des roles</button>
            </div>
          </form>
          {% if copilot_result is not empty %}
            <div class="copilot-answer">
              <h3>Reponse</h3>
              <p>{{ copilot_result.answer }}</p>
              <div class="copilot-links">
                {% for link in copilot_result.links %}
                  <a class="btn btn-outline small" href="{{ path(link.route) }}">{{ link.label }}</a>
                {% endfor %}
              </div>
            </div>
          {% endif %}
        </section>

        <section class="content-grid">
          <div class="panel">
            <div class="panel-header">
              <h2>ActivitÃ© rÃ©cente</h2>
              <span class="panel-sub">DerniÃ¨res 24 heures</span>
            </div>
            <div class="list">
              {% for activity in recent_activities %}
                <div class="list-item">
                  <div>
                    <div class="list-title">{{ activity.title }}</div>
                    <div class="list-meta">{{ activity.meta }}</div>
                  </div>
                  <span class="pill success">{{ activity.date|date('d/m H:i') }}</span>
                </div>
              {% else %}
                <div class="list-item">
                  <div>
                    <div class="list-title">Aucune activitÃ© rÃ©cente</div>
                    <div class="list-meta">Les nouvelles activitÃ©s apparaÃ®tront ici.</div>
                  </div>
                  <span class="pill warning">N/A</span>
                </div>
              {% endfor %}
            </div>
          </div>

          <div class="panel">
            <div class="panel-header">
              <h2>Ã‰tat des serveurs</h2>
              <span class="panel-sub">Monitoring</span>
            </div>
            <div class="list">
              <div class="list-item">
                <div class="list-title">Base de donnÃ©es 1</div>
                <span class="pill success">OpÃ©rationnel</span>
              </div>
              <div class="list-item">
                <div class="list-title">API Principale</div>
                <span class="pill success">OpÃ©rationnel</span>
              </div>
              <div class="list-item">
                <div class="list-title">Stockage</div>
                <span class="pill warning">Maintenance</span>
              </div>
            </div>
          </div>
        </section>

        <section class="panel full">
          <div class="panel-header">
            <h2>Classes populaires</h2>
            <span class="panel-sub">Top 4</span>
          </div>
          <div class="cards-row">
            {% for classe in popular_classes %}
              <div class="mini-card">
                <div class="mini-avatar">{{ classe.code }}</div>
                <div>
                  <div class="mini-title">{{ classe.title }}</div>
                  <div class="mini-meta">{{ classe.meta }}</div>
                </div>
              </div>
            {% else %}
              <div class="mini-card">
                <div class="mini-avatar">N/A</div>
                <div>
                  <div class="mini-title">Aucune classe</div>
                  <div class="mini-meta">CrÃ©ez un cours pour alimenter ce bloc</div>
                </div>
              </div>
            {% endfor %}
          </div>
        </section>
      </main>
    </div>
  </body>
</html>
