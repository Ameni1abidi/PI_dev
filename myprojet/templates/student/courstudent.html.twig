{% extends 'student/dashCours.html.twig' %}

{% block title %}Mes Cours{% endblock %}

{% block body %}
<div style="padding:25px; font-family:'Manrope', sans-serif; background:linear-gradient(135deg,#fdfbfb,#ebedee); min-height:100vh;">
  <h2 style="margin-bottom:25px; font-weight:800; font-size:1.8rem; color:#333;">Mes Cours</h2>

  <div style="margin-bottom:30px;">
    <form method="get" style="display:flex; gap:10px;">
      <input type="text" name="search"
             placeholder="Rechercher un cours..."
             value="{{ app.request.query.get('search') }}"
             style="flex:1; padding:12px 15px; border-radius:30px; border:none; outline:none; box-shadow:0 4px 10px rgba(0,0,0,0.05); font-size:0.9rem;">
      <button type="submit"
              style="padding:12px 20px; border-radius:30px; border:none; font-weight:600; background:linear-gradient(135deg,#667eea,#764ba2); color:white; cursor:pointer; box-shadow:0 4px 10px rgba(0,0,0,0.1);">
        Rechercher
      </button>
    </form>
  </div>

  {% if cours is not empty %}
    <div style="display:grid; grid-template-columns:repeat(auto-fill,minmax(320px,1fr)); gap:25px;">
      {% for cour in cours %}
        <div style="background:white; border-radius:20px; padding:20px; box-shadow:0 8px 20px rgba(0,0,0,0.06); display:flex; flex-direction:column; justify-content:space-between; transition:0.3s;">
          <div>
            <div style="font-weight:800; font-size:1.2rem; margin-bottom:8px; color:#444;">{{ cour.titre }}</div>
            {% if cour.description %}
              <div style="font-size:0.85rem; color:#777; margin-bottom:10px;">{{ cour.description|slice(0,100) }}...</div>
            {% endif %}
            <div style="font-size:0.75rem; color:#aaa; margin-bottom:12px;">{{ cour.dateCreation ? cour.dateCreation|date('d/m/Y') : 'N/A' }}</div>

            <a href="{{ path('eleve_cours_show', {'id': cour.id}) }}"
               style="display:inline-block; margin-bottom:14px; text-decoration:none; padding:9px 14px; border-radius:10px; background:linear-gradient(135deg,#2563eb,#1d4ed8); color:#fff; font-weight:700; font-size:0.86rem;">
              Voir les chapitres
            </a>

            {% if cour.chapitres is not empty %}
              <div style="margin-top:10px; display:flex; flex-direction:column; gap:10px;">
                {% for chap in cour.chapitres %}
                  {% set ressourcesCount = chap.ressources|length %}
                  <div style="background:#f6f8ff; border-radius:15px; padding:12px; box-shadow:0 2px 6px rgba(0,0,0,0.05); font-size:0.85rem; display:flex; flex-direction:column; gap:4px;">
                    <div style="font-weight:700; color:#555;">{{ chap.ordre }}. {{ chap.titre }}</div>
                    <div style="color:#666;">Duree : {{ chap.dureeEstimee }} min</div>
                    <div style="color:#666;">Type : {{ chap.typeContenu }}</div>

                    {% if ressourcesCount > 0 %}
                      <a href="{{ path('eleve_chapitre_ressources', {'id': chap.id}) }}"
                         style="margin-top:8px; display:inline-block; text-decoration:none; background:#fde7f3; color:#9d174d; border:1px solid #fbcfe8; padding:8px 10px; border-radius:10px; font-weight:700; font-size:0.8rem;">
                        Ressources du chapitre ({{ ressourcesCount }})
                      </a>
                    {% endif %}
                  </div>
                {% endfor %}
              </div>
            {% else %}
              <div style="margin-top:10px; font-size:0.8rem; color:#aaa;">Aucun chapitre pour ce cours.</div>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div style="text-align:center; padding:20px; background:white; border-radius:15px; box-shadow:0 4px 12px rgba(0,0,0,0.05); color:#777;">
      Aucun cours disponible pour le moment.
    </div>
  {% endif %}
</div>
{% endblock %}
