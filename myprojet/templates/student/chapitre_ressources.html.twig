{% extends 'student/dashCours.html.twig' %}

{% block title %}Ressources du chapitre{% endblock %}

{% block body %}
<div style="padding:25px; font-family:'Manrope', sans-serif; background:linear-gradient(140deg,#f8fbff,#eef2ff 55%,#f9fafb); min-height:100vh;">
  <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:16px;">
    <div>
      <h2 style="margin:0; font-weight:800; font-size:1.6rem; color:#1f2937;">Ressources du chapitre</h2>
      <div style="margin-top:6px; color:#4b5563; font-size:0.92rem;">Cours: {{ cours ? cours.titre : '' }} | Chapitre: {{ chapitre.titre }}</div>
    </div>
    <a href="{{ path('eleve_cours_show', {'id': cours.id}) }}" style="text-decoration:none; padding:9px 14px; border-radius:999px; background:#e0e7ff; color:#3730a3; font-weight:700;">Retour au chapitre</a>
  </div>

  {% if ressources is not empty %}
    <div style="display:grid; grid-template-columns:repeat(auto-fill,minmax(340px,1fr)); gap:18px;">
      {% for ressource in ressources %}
        {% set kind = ressource.categorie ? ressource.categorie.nom|lower : '' %}
        {% set isUrl = ressource.contenu starts with 'http://' or ressource.contenu starts with 'https://' %}

        <article style="background:#fff; border-radius:20px; padding:18px; box-shadow:0 14px 28px rgba(20,24,40,0.08); border:1px solid #e7ecff;">
          <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:10px; margin-bottom:12px;">
            <h3 style="margin:0; color:#1f2937; font-size:1.05rem;">{{ ressource.titre }}</h3>
            <span style="font-size:0.72rem; font-weight:700; text-transform:uppercase; letter-spacing:.03em; background:#f3f4f6; color:#374151; padding:4px 8px; border-radius:999px;">{{ kind }}</span>
          </div>

          {% if kind == 'video' %}
            {% if isUrl %}
              <a href="{{ ressource.contenu }}" target="_blank" rel="noopener" style="display:inline-block; padding:9px 12px; border-radius:10px; background:#dbeafe; color:#1e40af; font-weight:700; text-decoration:none;">Ouvrir la video</a>
            {% else %}
              <video controls preload="metadata" style="width:100%; border-radius:14px; background:#0f172a;">
                <source src="{{ asset(ressource.contenu) }}">
                Votre navigateur ne supporte pas la lecture video.
              </video>
            {% endif %}
          {% elseif kind == 'audio' %}
            {% if isUrl %}
              <a href="{{ ressource.contenu }}" target="_blank" rel="noopener" style="display:inline-block; padding:9px 12px; border-radius:10px; background:#ecfeff; color:#155e75; font-weight:700; text-decoration:none;">Ouvrir l'audio</a>
            {% else %}
              <audio controls preload="metadata" style="width:100%;">
                <source src="{{ asset(ressource.contenu) }}">
                Votre navigateur ne supporte pas la lecture audio.
              </audio>
            {% endif %}
          {% elseif kind == 'image' %}
            <img src="{{ asset(ressource.contenu) }}" alt="{{ ressource.titre }}" style="width:100%; border-radius:14px; object-fit:cover; max-height:260px;">
          {% elseif kind == 'lien' %}
            <a href="{{ ressource.contenu }}" target="_blank" rel="noopener" style="display:inline-block; padding:10px 14px; border-radius:10px; background:#dcfce7; color:#166534; font-weight:700; text-decoration:none;">Ouvrir le lien</a>
            <div style="margin-top:8px; font-size:0.8rem; color:#6b7280; word-break:break-all;">{{ ressource.contenu }}</div>
          {% else %}
            <div style="color:#6b7280;">Ressource indisponible.</div>
          {% endif %}
        </article>
      {% endfor %}
    </div>
  {% else %}
    <div style="background:#fff; border-radius:16px; padding:20px; color:#6b7280; box-shadow:0 10px 24px rgba(20,24,40,0.06);">
      Aucune ressource n'est disponible pour ce chapitre.
    </div>
  {% endif %}
</div>
{% endblock %}
